var le=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function st(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function he(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ne={exports:{}};var Xe;function fr(){return Xe||(Xe=1,(function(s,d){(function(u){s.exports=u()})(function(){return(function u(y,p,h){function _(I,O){if(!p[I]){if(!y[I]){var g=typeof he=="function"&&he;if(!O&&g)return g(I,!0);if(m)return m(I,!0);var E=new Error("Cannot find module '"+I+"'");throw E.code="MODULE_NOT_FOUND",E}var x=p[I]={exports:{}};y[I][0].call(x.exports,function(A){var F=y[I][1][A];return _(F||A)},x,x.exports,u,y,p,h)}return p[I].exports}for(var m=typeof he=="function"&&he,S=0;S<h.length;S++)_(h[S]);return _})({1:[function(u,y,p){(function(h){var _=h.MutationObserver||h.WebKitMutationObserver,m;if(_){var S=0,I=new _(A),O=h.document.createTextNode("");I.observe(O,{characterData:!0}),m=function(){O.data=S=++S%2}}else if(!h.setImmediate&&typeof h.MessageChannel<"u"){var g=new h.MessageChannel;g.port1.onmessage=A,m=function(){g.port2.postMessage(0)}}else"document"in h&&"onreadystatechange"in h.document.createElement("script")?m=function(){var $=h.document.createElement("script");$.onreadystatechange=function(){A(),$.onreadystatechange=null,$.parentNode.removeChild($),$=null},h.document.documentElement.appendChild($)}:m=function(){setTimeout(A,0)};var E,x=[];function A(){E=!0;for(var $,J,P=x.length;P;){for(J=x,x=[],$=-1;++$<P;)J[$]();P=x.length}E=!1}y.exports=F;function F($){x.push($)===1&&!E&&m()}}).call(this,typeof le<"u"?le:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(u,y,p){var h=u(1);function _(){}var m={},S=["REJECTED"],I=["FULFILLED"],O=["PENDING"];y.exports=g;function g(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=O,this.queue=[],this.outcome=void 0,b!==_&&F(this,b)}g.prototype.catch=function(b){return this.then(null,b)},g.prototype.then=function(b,C){if(typeof b!="function"&&this.state===I||typeof C!="function"&&this.state===S)return this;var D=new this.constructor(_);if(this.state!==O){var T=this.state===I?b:C;x(D,T,this.outcome)}else this.queue.push(new E(D,b,C));return D};function E(b,C,D){this.promise=b,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof D=="function"&&(this.onRejected=D,this.callRejected=this.otherCallRejected)}E.prototype.callFulfilled=function(b){m.resolve(this.promise,b)},E.prototype.otherCallFulfilled=function(b){x(this.promise,this.onFulfilled,b)},E.prototype.callRejected=function(b){m.reject(this.promise,b)},E.prototype.otherCallRejected=function(b){x(this.promise,this.onRejected,b)};function x(b,C,D){h(function(){var T;try{T=C(D)}catch(k){return m.reject(b,k)}T===b?m.reject(b,new TypeError("Cannot resolve promise with itself")):m.resolve(b,T)})}m.resolve=function(b,C){var D=$(A,C);if(D.status==="error")return m.reject(b,D.value);var T=D.value;if(T)F(b,T);else{b.state=I,b.outcome=C;for(var k=-1,M=b.queue.length;++k<M;)b.queue[k].callFulfilled(C)}return b},m.reject=function(b,C){b.state=S,b.outcome=C;for(var D=-1,T=b.queue.length;++D<T;)b.queue[D].callRejected(C);return b};function A(b){var C=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof C=="function")return function(){C.apply(b,arguments)}}function F(b,C){var D=!1;function T(W){D||(D=!0,m.reject(b,W))}function k(W){D||(D=!0,m.resolve(b,W))}function M(){C(k,T)}var Q=$(M);Q.status==="error"&&T(Q.value)}function $(b,C){var D={};try{D.value=b(C),D.status="success"}catch(T){D.status="error",D.value=T}return D}g.resolve=J;function J(b){return b instanceof this?b:m.resolve(new this(_),b)}g.reject=P;function P(b){var C=new this(_);return m.reject(C,b)}g.all=H;function H(b){var C=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=b.length,T=!1;if(!D)return this.resolve([]);for(var k=new Array(D),M=0,Q=-1,W=new this(_);++Q<D;)V(b[Q],Q);return W;function V(ie,ue){C.resolve(ie).then(ve,function(te){T||(T=!0,m.reject(W,te))});function ve(te){k[ue]=te,++M===D&&!T&&(T=!0,m.resolve(W,k))}}}g.race=q;function q(b){var C=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=b.length,T=!1;if(!D)return this.resolve([]);for(var k=-1,M=new this(_);++k<D;)Q(b[k]);return M;function Q(W){C.resolve(W).then(function(V){T||(T=!0,m.resolve(M,V))},function(V){T||(T=!0,m.reject(M,V))})}}},{1:1}],3:[function(u,y,p){(function(h){typeof h.Promise!="function"&&(h.Promise=u(2))}).call(this,typeof le<"u"?le:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(u,y,p){var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function m(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var S=m();function I(){try{if(!S||!S.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||r)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function O(e,r){e=e||[],r=r||{};try{return new Blob(e,r)}catch(n){if(n.name!=="TypeError")throw n;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,i=new t,o=0;o<e.length;o+=1)i.append(e[o]);return i.getBlob(r.type)}}typeof Promise>"u"&&u(3);var g=Promise;function E(e,r){r&&e.then(function(t){r(null,t)},function(t){r(t)})}function x(e,r,t){typeof r=="function"&&e.then(r),typeof t=="function"&&e.catch(t)}function A(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function F(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var $="local-forage-detect-blob-support",J=void 0,P={},H=Object.prototype.toString,q="readonly",b="readwrite";function C(e){for(var r=e.length,t=new ArrayBuffer(r),i=new Uint8Array(t),o=0;o<r;o++)i[o]=e.charCodeAt(o);return t}function D(e){return new g(function(r){var t=e.transaction($,b),i=O([""]);t.objectStore($).put(i,"key"),t.onabort=function(o){o.preventDefault(),o.stopPropagation(),r(!1)},t.oncomplete=function(){var o=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);r(n||!o||parseInt(o[1],10)>=43)}}).catch(function(){return!1})}function T(e){return typeof J=="boolean"?g.resolve(J):D(e).then(function(r){return J=r,J})}function k(e){var r=P[e.name],t={};t.promise=new g(function(i,o){t.resolve=i,t.reject=o}),r.deferredOperations.push(t),r.dbReady?r.dbReady=r.dbReady.then(function(){return t.promise}):r.dbReady=t.promise}function M(e){var r=P[e.name],t=r.deferredOperations.pop();if(t)return t.resolve(),t.promise}function Q(e,r){var t=P[e.name],i=t.deferredOperations.pop();if(i)return i.reject(r),i.promise}function W(e,r){return new g(function(t,i){if(P[e.name]=P[e.name]||Te(),e.db)if(r)k(e),e.db.close();else return t(e.db);var o=[e.name];r&&o.push(e.version);var n=S.open.apply(S,o);r&&(n.onupgradeneeded=function(a){var f=n.result;try{f.createObjectStore(e.storeName),a.oldVersion<=1&&f.createObjectStore($)}catch(c){if(c.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+a.oldVersion+" to version "+a.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw c}}),n.onerror=function(a){a.preventDefault(),i(n.error)},n.onsuccess=function(){var a=n.result;a.onversionchange=function(f){f.target.close()},t(a),M(e)}})}function V(e){return W(e,!1)}function ie(e){return W(e,!0)}function ue(e,r){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),i=e.version<e.db.version,o=e.version>e.db.version;if(i&&(e.version!==r&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||t){if(t){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function ve(e){return new g(function(r,t){var i=new FileReader;i.onerror=t,i.onloadend=function(o){var n=btoa(o.target.result||"");r({__local_forage_encoded_blob:!0,data:n,type:e.type})},i.readAsBinaryString(e)})}function te(e){var r=C(atob(e.data));return O([r],{type:e.type})}function Ae(e){return e&&e.__local_forage_encoded_blob}function ct(e){var r=this,t=r._initReady().then(function(){var i=P[r._dbInfo.name];if(i&&i.dbReady)return i.dbReady});return x(t,e,e),t}function lt(e){k(e);for(var r=P[e.name],t=r.forages,i=0;i<t.length;i++){var o=t[i];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,V(e).then(function(n){return e.db=n,ue(e)?ie(e):n}).then(function(n){e.db=r.db=n;for(var a=0;a<t.length;a++)t[a]._dbInfo.db=n}).catch(function(n){throw Q(e,n),n})}function G(e,r,t,i){i===void 0&&(i=1);try{var o=e.db.transaction(e.storeName,r);t(null,o)}catch(n){if(i>0&&(!e.db||n.name==="InvalidStateError"||n.name==="NotFoundError"))return g.resolve().then(function(){if(!e.db||n.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),ie(e)}).then(function(){return lt(e).then(function(){G(e,r,t,i-1)})}).catch(t);t(n)}}function Te(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function ht(e){var r=this,t={db:null};if(e)for(var i in e)t[i]=e[i];var o=P[t.name];o||(o=Te(),P[t.name]=o),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=ct);var n=[];function a(){return g.resolve()}for(var f=0;f<o.forages.length;f++){var c=o.forages[f];c!==r&&n.push(c._initReady().catch(a))}var l=o.forages.slice(0);return g.all(n).then(function(){return t.db=o.db,V(t)}).then(function(v){return t.db=v,ue(t,r._defaultConfig.version)?ie(t):v}).then(function(v){t.db=o.db=v,r._dbInfo=t;for(var w=0;w<l.length;w++){var N=l[w];N!==r&&(N._dbInfo.db=t.db,N._dbInfo.version=t.version)}})}function dt(e,r){var t=this;e=A(e);var i=new g(function(o,n){t.ready().then(function(){G(t._dbInfo,q,function(a,f){if(a)return n(a);try{var c=f.objectStore(t._dbInfo.storeName),l=c.get(e);l.onsuccess=function(){var v=l.result;v===void 0&&(v=null),Ae(v)&&(v=te(v)),o(v)},l.onerror=function(){n(l.error)}}catch(v){n(v)}})}).catch(n)});return E(i,r),i}function vt(e,r){var t=this,i=new g(function(o,n){t.ready().then(function(){G(t._dbInfo,q,function(a,f){if(a)return n(a);try{var c=f.objectStore(t._dbInfo.storeName),l=c.openCursor(),v=1;l.onsuccess=function(){var w=l.result;if(w){var N=w.value;Ae(N)&&(N=te(N));var R=e(N,w.key,v++);R!==void 0?o(R):w.continue()}else o()},l.onerror=function(){n(l.error)}}catch(w){n(w)}})}).catch(n)});return E(i,r),i}function mt(e,r,t){var i=this;e=A(e);var o=new g(function(n,a){var f;i.ready().then(function(){return f=i._dbInfo,H.call(r)==="[object Blob]"?T(f.db).then(function(c){return c?r:ve(r)}):r}).then(function(c){G(i._dbInfo,b,function(l,v){if(l)return a(l);try{var w=v.objectStore(i._dbInfo.storeName);c===null&&(c=void 0);var N=w.put(c,e);v.oncomplete=function(){c===void 0&&(c=null),n(c)},v.onabort=v.onerror=function(){var R=N.error?N.error:N.transaction.error;a(R)}}catch(R){a(R)}})}).catch(a)});return E(o,t),o}function yt(e,r){var t=this;e=A(e);var i=new g(function(o,n){t.ready().then(function(){G(t._dbInfo,b,function(a,f){if(a)return n(a);try{var c=f.objectStore(t._dbInfo.storeName),l=c.delete(e);f.oncomplete=function(){o()},f.onerror=function(){n(l.error)},f.onabort=function(){var v=l.error?l.error:l.transaction.error;n(v)}}catch(v){n(v)}})}).catch(n)});return E(i,r),i}function gt(e){var r=this,t=new g(function(i,o){r.ready().then(function(){G(r._dbInfo,b,function(n,a){if(n)return o(n);try{var f=a.objectStore(r._dbInfo.storeName),c=f.clear();a.oncomplete=function(){i()},a.onabort=a.onerror=function(){var l=c.error?c.error:c.transaction.error;o(l)}}catch(l){o(l)}})}).catch(o)});return E(t,e),t}function pt(e){var r=this,t=new g(function(i,o){r.ready().then(function(){G(r._dbInfo,q,function(n,a){if(n)return o(n);try{var f=a.objectStore(r._dbInfo.storeName),c=f.count();c.onsuccess=function(){i(c.result)},c.onerror=function(){o(c.error)}}catch(l){o(l)}})}).catch(o)});return E(t,e),t}function bt(e,r){var t=this,i=new g(function(o,n){if(e<0){o(null);return}t.ready().then(function(){G(t._dbInfo,q,function(a,f){if(a)return n(a);try{var c=f.objectStore(t._dbInfo.storeName),l=!1,v=c.openKeyCursor();v.onsuccess=function(){var w=v.result;if(!w){o(null);return}e===0||l?o(w.key):(l=!0,w.advance(e))},v.onerror=function(){n(v.error)}}catch(w){n(w)}})}).catch(n)});return E(i,r),i}function _t(e){var r=this,t=new g(function(i,o){r.ready().then(function(){G(r._dbInfo,q,function(n,a){if(n)return o(n);try{var f=a.objectStore(r._dbInfo.storeName),c=f.openKeyCursor(),l=[];c.onsuccess=function(){var v=c.result;if(!v){i(l);return}l.push(v.key),v.continue()},c.onerror=function(){o(c.error)}}catch(v){o(v)}})}).catch(o)});return E(t,e),t}function wt(e,r){r=F.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var i=this,o;if(!e.name)o=g.reject("Invalid arguments");else{var n=e.name===t.name&&i._dbInfo.db,a=n?g.resolve(i._dbInfo.db):V(e).then(function(f){var c=P[e.name],l=c.forages;c.db=f;for(var v=0;v<l.length;v++)l[v]._dbInfo.db=f;return f});e.storeName?o=a.then(function(f){if(f.objectStoreNames.contains(e.storeName)){var c=f.version+1;k(e);var l=P[e.name],v=l.forages;f.close();for(var w=0;w<v.length;w++){var N=v[w];N._dbInfo.db=null,N._dbInfo.version=c}var R=new g(function(B,U){var L=S.open(e.name,c);L.onerror=function(j){var ae=L.result;ae.close(),U(j)},L.onupgradeneeded=function(){var j=L.result;j.deleteObjectStore(e.storeName)},L.onsuccess=function(){var j=L.result;j.close(),B(j)}});return R.then(function(B){l.db=B;for(var U=0;U<v.length;U++){var L=v[U];L._dbInfo.db=B,M(L._dbInfo)}}).catch(function(B){throw(Q(e,B)||g.resolve()).catch(function(){}),B})}}):o=a.then(function(f){k(e);var c=P[e.name],l=c.forages;f.close();for(var v=0;v<l.length;v++){var w=l[v];w._dbInfo.db=null}var N=new g(function(R,B){var U=S.deleteDatabase(e.name);U.onerror=function(){var L=U.result;L&&L.close(),B(U.error)},U.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},U.onsuccess=function(){var L=U.result;L&&L.close(),R(L)}});return N.then(function(R){c.db=R;for(var B=0;B<l.length;B++){var U=l[B];M(U._dbInfo)}}).catch(function(R){throw(Q(e,R)||g.resolve()).catch(function(){}),R})})}return E(o,r),o}var St={_driver:"asyncStorage",_initStorage:ht,_support:I(),iterate:vt,getItem:dt,setItem:mt,removeItem:yt,clear:gt,length:pt,key:bt,keys:_t,dropInstance:wt};function Et(){return typeof openDatabase=="function"}var X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Nt="~~local_forage_type~",Oe=/^~~local_forage_type~([^~]+)~/,fe="__lfsc__:",me=fe.length,ye="arbf",ge="blob",$e="si08",Pe="ui08",Le="uic8",Ue="si16",Fe="si32",ke="ur16",Me="ui32",Ye="fl32",Je="fl64",qe=me+ye.length,Qe=Object.prototype.toString;function We(e){var r=e.length*.75,t=e.length,i,o=0,n,a,f,c;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);var l=new ArrayBuffer(r),v=new Uint8Array(l);for(i=0;i<t;i+=4)n=X.indexOf(e[i]),a=X.indexOf(e[i+1]),f=X.indexOf(e[i+2]),c=X.indexOf(e[i+3]),v[o++]=n<<2|a>>4,v[o++]=(a&15)<<4|f>>2,v[o++]=(f&3)<<6|c&63;return l}function pe(e){var r=new Uint8Array(e),t="",i;for(i=0;i<r.length;i+=3)t+=X[r[i]>>2],t+=X[(r[i]&3)<<4|r[i+1]>>4],t+=X[(r[i+1]&15)<<2|r[i+2]>>6],t+=X[r[i+2]&63];return r.length%3===2?t=t.substring(0,t.length-1)+"=":r.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function Dt(e,r){var t="";if(e&&(t=Qe.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&Qe.call(e.buffer)==="[object ArrayBuffer]")){var i,o=fe;e instanceof ArrayBuffer?(i=e,o+=ye):(i=e.buffer,t==="[object Int8Array]"?o+=$e:t==="[object Uint8Array]"?o+=Pe:t==="[object Uint8ClampedArray]"?o+=Le:t==="[object Int16Array]"?o+=Ue:t==="[object Uint16Array]"?o+=ke:t==="[object Int32Array]"?o+=Fe:t==="[object Uint32Array]"?o+=Me:t==="[object Float32Array]"?o+=Ye:t==="[object Float64Array]"?o+=Je:r(new Error("Failed to get type for BinaryArray"))),r(o+pe(i))}else if(t==="[object Blob]"){var n=new FileReader;n.onload=function(){var a=Nt+e.type+"~"+pe(this.result);r(fe+ge+a)},n.readAsArrayBuffer(e)}else try{r(JSON.stringify(e))}catch(a){console.error("Couldn't convert value into a JSON string: ",e),r(null,a)}}function It(e){if(e.substring(0,me)!==fe)return JSON.parse(e);var r=e.substring(qe),t=e.substring(me,qe),i;if(t===ge&&Oe.test(r)){var o=r.match(Oe);i=o[1],r=r.substring(o[0].length)}var n=We(r);switch(t){case ye:return n;case ge:return O([n],{type:i});case $e:return new Int8Array(n);case Pe:return new Uint8Array(n);case Le:return new Uint8ClampedArray(n);case Ue:return new Int16Array(n);case ke:return new Uint16Array(n);case Fe:return new Int32Array(n);case Me:return new Uint32Array(n);case Ye:return new Float32Array(n);case Je:return new Float64Array(n);default:throw new Error("Unkown type: "+t)}}var be={serialize:Dt,deserialize:It,stringToBuffer:We,bufferToString:pe};function je(e,r,t,i){e.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,i)}function Ct(e){var r=this,t={db:null};if(e)for(var i in e)t[i]=typeof e[i]!="string"?e[i].toString():e[i];var o=new g(function(n,a){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(f){return a(f)}t.db.transaction(function(f){je(f,t,function(){r._dbInfo=t,n()},function(c,l){a(l)})},a)});return t.serializer=be,o}function Z(e,r,t,i,o,n){e.executeSql(t,i,o,function(a,f){f.code===f.SYNTAX_ERR?a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[r.storeName],function(c,l){l.rows.length?n(c,f):je(c,r,function(){c.executeSql(t,i,o,n)},n)},n):n(a,f)},n)}function Rt(e,r){var t=this;e=A(e);var i=new g(function(o,n){t.ready().then(function(){var a=t._dbInfo;a.db.transaction(function(f){Z(f,a,"SELECT * FROM "+a.storeName+" WHERE key = ? LIMIT 1",[e],function(c,l){var v=l.rows.length?l.rows.item(0).value:null;v&&(v=a.serializer.deserialize(v)),o(v)},function(c,l){n(l)})})}).catch(n)});return E(i,r),i}function xt(e,r){var t=this,i=new g(function(o,n){t.ready().then(function(){var a=t._dbInfo;a.db.transaction(function(f){Z(f,a,"SELECT * FROM "+a.storeName,[],function(c,l){for(var v=l.rows,w=v.length,N=0;N<w;N++){var R=v.item(N),B=R.value;if(B&&(B=a.serializer.deserialize(B)),B=e(B,R.key,N+1),B!==void 0){o(B);return}}o()},function(c,l){n(l)})})}).catch(n)});return E(i,r),i}function ze(e,r,t,i){var o=this;e=A(e);var n=new g(function(a,f){o.ready().then(function(){r===void 0&&(r=null);var c=r,l=o._dbInfo;l.serializer.serialize(r,function(v,w){w?f(w):l.db.transaction(function(N){Z(N,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,v],function(){a(c)},function(R,B){f(B)})},function(N){if(N.code===N.QUOTA_ERR){if(i>0){a(ze.apply(o,[e,c,t,i-1]));return}f(N)}})})}).catch(f)});return E(n,t),n}function Bt(e,r,t){return ze.apply(this,[e,r,t,1])}function At(e,r){var t=this;e=A(e);var i=new g(function(o,n){t.ready().then(function(){var a=t._dbInfo;a.db.transaction(function(f){Z(f,a,"DELETE FROM "+a.storeName+" WHERE key = ?",[e],function(){o()},function(c,l){n(l)})})}).catch(n)});return E(i,r),i}function Tt(e){var r=this,t=new g(function(i,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(a){Z(a,n,"DELETE FROM "+n.storeName,[],function(){i()},function(f,c){o(c)})})}).catch(o)});return E(t,e),t}function Ot(e){var r=this,t=new g(function(i,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(a){Z(a,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(f,c){var l=c.rows.item(0).c;i(l)},function(f,c){o(c)})})}).catch(o)});return E(t,e),t}function $t(e,r){var t=this,i=new g(function(o,n){t.ready().then(function(){var a=t._dbInfo;a.db.transaction(function(f){Z(f,a,"SELECT key FROM "+a.storeName+" WHERE id = ? LIMIT 1",[e+1],function(c,l){var v=l.rows.length?l.rows.item(0).key:null;o(v)},function(c,l){n(l)})})}).catch(n)});return E(i,r),i}function Pt(e){var r=this,t=new g(function(i,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(a){Z(a,n,"SELECT key FROM "+n.storeName,[],function(f,c){for(var l=[],v=0;v<c.rows.length;v++)l.push(c.rows.item(v).key);i(l)},function(f,c){o(c)})})}).catch(o)});return E(t,e),t}function Lt(e){return new g(function(r,t){e.transaction(function(i){i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(o,n){for(var a=[],f=0;f<n.rows.length;f++)a.push(n.rows.item(f).name);r({db:e,storeNames:a})},function(o,n){t(n)})},function(i){t(i)})})}function Ut(e,r){r=F.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var i=this,o;return e.name?o=new g(function(n){var a;e.name===t.name?a=i._dbInfo.db:a=openDatabase(e.name,"","",0),e.storeName?n({db:a,storeNames:[e.storeName]}):n(Lt(a))}).then(function(n){return new g(function(a,f){n.db.transaction(function(c){function l(R){return new g(function(B,U){c.executeSql("DROP TABLE IF EXISTS "+R,[],function(){B()},function(L,j){U(j)})})}for(var v=[],w=0,N=n.storeNames.length;w<N;w++)v.push(l(n.storeNames[w]));g.all(v).then(function(){a()}).catch(function(R){f(R)})},function(c){f(c)})})}):o=g.reject("Invalid arguments"),E(o,r),o}var Ft={_driver:"webSQLStorage",_initStorage:Ct,_support:Et(),iterate:xt,getItem:Rt,setItem:Bt,removeItem:At,clear:Tt,length:Ot,key:$t,keys:Pt,dropInstance:Ut};function kt(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Ke(e,r){var t=e.name+"/";return e.storeName!==r.storeName&&(t+=e.storeName+"/"),t}function Mt(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function Yt(){return!Mt()||localStorage.length>0}function Jt(e){var r=this,t={};if(e)for(var i in e)t[i]=e[i];return t.keyPrefix=Ke(e,r._defaultConfig),Yt()?(r._dbInfo=t,t.serializer=be,g.resolve()):g.reject()}function qt(e){var r=this,t=r.ready().then(function(){for(var i=r._dbInfo.keyPrefix,o=localStorage.length-1;o>=0;o--){var n=localStorage.key(o);n.indexOf(i)===0&&localStorage.removeItem(n)}});return E(t,e),t}function Qt(e,r){var t=this;e=A(e);var i=t.ready().then(function(){var o=t._dbInfo,n=localStorage.getItem(o.keyPrefix+e);return n&&(n=o.serializer.deserialize(n)),n});return E(i,r),i}function Wt(e,r){var t=this,i=t.ready().then(function(){for(var o=t._dbInfo,n=o.keyPrefix,a=n.length,f=localStorage.length,c=1,l=0;l<f;l++){var v=localStorage.key(l);if(v.indexOf(n)===0){var w=localStorage.getItem(v);if(w&&(w=o.serializer.deserialize(w)),w=e(w,v.substring(a),c++),w!==void 0)return w}}});return E(i,r),i}function jt(e,r){var t=this,i=t.ready().then(function(){var o=t._dbInfo,n;try{n=localStorage.key(e)}catch{n=null}return n&&(n=n.substring(o.keyPrefix.length)),n});return E(i,r),i}function zt(e){var r=this,t=r.ready().then(function(){for(var i=r._dbInfo,o=localStorage.length,n=[],a=0;a<o;a++){var f=localStorage.key(a);f.indexOf(i.keyPrefix)===0&&n.push(f.substring(i.keyPrefix.length))}return n});return E(t,e),t}function Kt(e){var r=this,t=r.keys().then(function(i){return i.length});return E(t,e),t}function Vt(e,r){var t=this;e=A(e);var i=t.ready().then(function(){var o=t._dbInfo;localStorage.removeItem(o.keyPrefix+e)});return E(i,r),i}function Gt(e,r,t){var i=this;e=A(e);var o=i.ready().then(function(){r===void 0&&(r=null);var n=r;return new g(function(a,f){var c=i._dbInfo;c.serializer.serialize(r,function(l,v){if(v)f(v);else try{localStorage.setItem(c.keyPrefix+e,l),a(n)}catch(w){(w.name==="QuotaExceededError"||w.name==="NS_ERROR_DOM_QUOTA_REACHED")&&f(w),f(w)}})})});return E(o,t),o}function Ht(e,r){if(r=F.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var i=this,o;return e.name?o=new g(function(n){e.storeName?n(Ke(e,i._defaultConfig)):n(e.name+"/")}).then(function(n){for(var a=localStorage.length-1;a>=0;a--){var f=localStorage.key(a);f.indexOf(n)===0&&localStorage.removeItem(f)}}):o=g.reject("Invalid arguments"),E(o,r),o}var Xt={_driver:"localStorageWrapper",_initStorage:Jt,_support:kt(),iterate:Wt,getItem:Qt,setItem:Gt,removeItem:Vt,clear:qt,length:Kt,key:jt,keys:zt,dropInstance:Ht},Zt=function(r,t){return r===t||typeof r=="number"&&typeof t=="number"&&isNaN(r)&&isNaN(t)},er=function(r,t){for(var i=r.length,o=0;o<i;){if(Zt(r[o],t))return!0;o++}return!1},Ve=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},oe={},Ge={},re={INDEXEDDB:St,WEBSQL:Ft,LOCALSTORAGE:Xt},tr=[re.INDEXEDDB._driver,re.WEBSQL._driver,re.LOCALSTORAGE._driver],ce=["dropInstance"],_e=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ce),rr={description:"",driver:tr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function nr(e,r){e[r]=function(){var t=arguments;return e.ready().then(function(){return e[r].apply(e,t)})}}function we(){for(var e=1;e<arguments.length;e++){var r=arguments[e];if(r)for(var t in r)r.hasOwnProperty(t)&&(Ve(r[t])?arguments[0][t]=r[t].slice():arguments[0][t]=r[t])}return arguments[0]}var ir=(function(){function e(r){_(this,e);for(var t in re)if(re.hasOwnProperty(t)){var i=re[t],o=i._driver;this[t]=o,oe[o]||this.defineDriver(i)}this._defaultConfig=we({},rr),this._config=we({},this._defaultConfig,r),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":h(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var i in t){if(i==="storeName"&&(t[i]=t[i].replace(/\W/g,"_")),i==="version"&&typeof t[i]!="number")return new Error("Database version must be a number.");this._config[i]=t[i]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,i,o){var n=new g(function(a,f){try{var c=t._driver,l=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){f(l);return}for(var v=_e.concat("_initStorage"),w=0,N=v.length;w<N;w++){var R=v[w],B=!er(ce,R);if((B||t[R])&&typeof t[R]!="function"){f(l);return}}var U=function(){for(var ae=function(sr){return function(){var ur=new Error("Method "+sr+" is not implemented by the current driver"),He=g.reject(ur);return E(He,arguments[arguments.length-1]),He}},Se=0,ar=ce.length;Se<ar;Se++){var Ee=ce[Se];t[Ee]||(t[Ee]=ae(Ee))}};U();var L=function(ae){oe[c]&&console.info("Redefining LocalForage driver: "+c),oe[c]=t,Ge[c]=ae,a()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(L,f):L(!!t._support):L(!0)}catch(j){f(j)}});return x(n,i,o),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,i,o){var n=oe[t]?g.resolve(oe[t]):g.reject(new Error("Driver not found."));return x(n,i,o),n},e.prototype.getSerializer=function(t){var i=g.resolve(be);return x(i,t),i},e.prototype.ready=function(t){var i=this,o=i._driverSet.then(function(){return i._ready===null&&(i._ready=i._initDriver()),i._ready});return x(o,t,t),o},e.prototype.setDriver=function(t,i,o){var n=this;Ve(t)||(t=[t]);var a=this._getSupportedDrivers(t);function f(){n._config.driver=n.driver()}function c(w){return n._extend(w),f(),n._ready=n._initStorage(n._config),n._ready}function l(w){return function(){var N=0;function R(){for(;N<w.length;){var B=w[N];return N++,n._dbInfo=null,n._ready=null,n.getDriver(B).then(c).catch(R)}f();var U=new Error("No available storage method found.");return n._driverSet=g.reject(U),n._driverSet}return R()}}var v=this._driverSet!==null?this._driverSet.catch(function(){return g.resolve()}):g.resolve();return this._driverSet=v.then(function(){var w=a[0];return n._dbInfo=null,n._ready=null,n.getDriver(w).then(function(N){n._driver=N._driver,f(),n._wrapLibraryMethodsWithReady(),n._initDriver=l(a)})}).catch(function(){f();var w=new Error("No available storage method found.");return n._driverSet=g.reject(w),n._driverSet}),x(this._driverSet,i,o),this._driverSet},e.prototype.supports=function(t){return!!Ge[t]},e.prototype._extend=function(t){we(this,t)},e.prototype._getSupportedDrivers=function(t){for(var i=[],o=0,n=t.length;o<n;o++){var a=t[o];this.supports(a)&&i.push(a)}return i},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,i=_e.length;t<i;t++)nr(this,_e[t])},e.prototype.createInstance=function(t){return new e(t)},e})(),or=new ir;y.exports=or},{3:3}]},{},[4])(4)})})(Ne)),Ne.exports}var cr=fr();const Ze=st(cr);function lr(s){if(s){if(typeof s!="string")return this.userErrors.push("Collection name in collection() method must be a string and not an object, number or boolean."),this;{this.collectionName=s;let d=this.dbName;return s in this.lf||(this.lf[s]=Ze.createInstance({driver:Ze.INDEXEDDB,name:d,storeName:s})),this}}else return this.userErrors.push("No collection name specified in collection() method."),this}function hr(s){return s?typeof s!="string"&&typeof s!="object"?this.userErrors.push("Document criteria specified in doc() method must not be a number or boolean. Use a string (with a key) or an object (with criteria) e.g. { id: 1 }"):this.docSelectionCriteria=s:this.userErrors.push("No document criteria specified in doc() method. Use a string (with a key) or an object (with criteria) e.g. { id: 1 }"),this}function dr(s,d){return s?typeof s!="string"?this.userErrors.push("First parameter in orderBy() method must be a string (a field name) e.g. 'name'"):this.orderByProperty=s:this.userErrors.push("No field name specified in orderBy() method. Use a string e.g. 'name'"),d&&(d!=="asc"&&d!=="desc"?this.userErrors.push("Second parameter in orderBy() method must be a string set to 'asc' or 'desc'."):this.orderByDirection=d),this}function vr(s){return s?Number.isInteger(s)?this.limitBy=s:this.userErrors.push("Limit parameter in limit() method must be an integer (e.g. 3) and not a float, boolean, string or object."):this.userErrors.push("No integer specified in limit() method."),this}function ne(s,d){return Object.keys(d).every(u=>typeof d[u]=="object"?ne(s[u],d[u]):d[u]===s[u])}let z={log(s,d){},error(s,d){},warn(s,d){}};function ee(){this.collectionName=null,this.orderByProperty=null,this.orderByDirection=null,this.limitBy=null,this.docSelectionCriteria=null,this.userErrors=[]}function Be(){let s;return!this.collectionName&&!this.docSelectionCriteria?s="db":this.collectionName&&!this.docSelectionCriteria?s="collection":this.collectionName&&this.docSelectionCriteria&&(s="doc"),s}function se(){for(let s=0;s<this.userErrors.length;s++)z.error.call(this,this.userErrors[s]);ee.call(this)}function mr(s={keys:!1}){if(this.getCollection=()=>{let d=this.collectionName,u=this.orderByProperty,y=this.orderByDirection,p=s.filter,h=this.limitBy,_=[];return this.lf[d].iterate((m,S)=>{let I={};s.keys?I={key:S,data:m}:I=m,p?ne(m,p)&&_.push(I):_.push(I)}).then(()=>{let m=`Got "${d}" collection`;return u&&(m+=`, ordered by "${u}"`,s.keys?_.sort((S,I)=>!S.hasOwnProperty(u)||!I.hasOwnProperty(u)?0:S.data[u].toString().localeCompare(I.data[u].toString())):_.sort((S,I)=>!S.hasOwnProperty(u)||!I.hasOwnProperty(u)?0:S[u].toString().localeCompare(I[u].toString()))),y=="desc"&&(m+=" (descending)",_.reverse()),h&&(m+=`, limited to ${h}`,_=_.splice(0,h)),m+=":",z.log.call(this,m,_),ee.call(this),_})},this.getDocument=()=>{let d=this.collectionName,u=this.docSelectionCriteria,y=[],p={};return this.getDocumentByCriteria=()=>this.lf[d].iterate((h,_)=>{ne(h,u)&&y.push(h)}).then(()=>{if(!y.length)z.error.call(this,`Could not find Document in "${d}" collection with criteria: ${JSON.stringify(u)}`);else return p=y[0],z.log.call(this,`Got Document with ${JSON.stringify(u)}:`,p),ee.call(this),p}),this.getDocumentByKey=()=>this.lf[d].getItem(u).then(h=>(p=h,p?z.log.call(this,`Got Document with key ${JSON.stringify(u)}:`,p):z.error.call(this,`Could not find Document in "${d}" collection with Key: ${JSON.stringify(u)}`),ee.call(this),p)).catch(h=>{z.error.call(this,`Could not find Document in "${d}" collection with Key: ${JSON.stringify(u)}`),ee.call(this)}),typeof u=="object"?this.getDocumentByCriteria():this.getDocumentByKey()},typeof s=="object"&&!(s instanceof Array)?s.hasOwnProperty("keys")?typeof s.keys!="boolean"&&this.userErrors.push('Property "keys" passed into get() method must be assigned a boolean value (true or false). Not a string or integer.'):this.userErrors.push('Object passed to get() method must contain a "keys" property set to boolean true or false, e.g. { keys: true }'):this.userErrors.push('Data passed to .get() must be an object. Not an array, string, number or boolean. The object must contain a "keys" property set to true or false, e.g. { keys: true }'),this.userErrors.length)return se.call(this),null;{let d=Be.call(this);if(d=="collection")return this.getCollection();if(d=="doc")return this.getDocument()}}var de={exports:{}},et;function ut(){if(et)return de.exports;et=1;var s=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(s){var d=new Uint8Array(16);de.exports=function(){return s(d),d}}else{var u=new Array(16);de.exports=function(){for(var p=0,h;p<16;p++)(p&3)===0&&(h=Math.random()*4294967296),u[p]=h>>>((p&3)<<3)&255;return u}}return de.exports}var De,tt;function ft(){if(tt)return De;tt=1;for(var s=[],d=0;d<256;++d)s[d]=(d+256).toString(16).substr(1);function u(y,p){var h=p||0,_=s;return[_[y[h++]],_[y[h++]],_[y[h++]],_[y[h++]],"-",_[y[h++]],_[y[h++]],"-",_[y[h++]],_[y[h++]],"-",_[y[h++]],_[y[h++]],"-",_[y[h++]],_[y[h++]],_[y[h++]],_[y[h++]],_[y[h++]],_[y[h++]]].join("")}return De=u,De}var Ie,rt;function yr(){if(rt)return Ie;rt=1;var s=ut(),d=ft(),u,y,p=0,h=0;function _(m,S,I){var O=S&&I||0,g=S||[];m=m||{};var E=m.node||u,x=m.clockseq!==void 0?m.clockseq:y;if(E==null||x==null){var A=s();E==null&&(E=u=[A[0]|1,A[1],A[2],A[3],A[4],A[5]]),x==null&&(x=y=(A[6]<<8|A[7])&16383)}var F=m.msecs!==void 0?m.msecs:new Date().getTime(),$=m.nsecs!==void 0?m.nsecs:h+1,J=F-p+($-h)/1e4;if(J<0&&m.clockseq===void 0&&(x=x+1&16383),(J<0||F>p)&&m.nsecs===void 0&&($=0),$>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=F,h=$,y=x,F+=122192928e5;var P=((F&268435455)*1e4+$)%4294967296;g[O++]=P>>>24&255,g[O++]=P>>>16&255,g[O++]=P>>>8&255,g[O++]=P&255;var H=F/4294967296*1e4&268435455;g[O++]=H>>>8&255,g[O++]=H&255,g[O++]=H>>>24&15|16,g[O++]=H>>>16&255,g[O++]=x>>>8|128,g[O++]=x&255;for(var q=0;q<6;++q)g[O+q]=E[q];return S||d(g)}return Ie=_,Ie}var Ce,nt;function gr(){if(nt)return Ce;nt=1;var s=ut(),d=ft();function u(y,p,h){var _=p&&h||0;typeof y=="string"&&(p=y==="binary"?new Array(16):null,y=null),y=y||{};var m=y.random||(y.rng||s)();if(m[6]=m[6]&15|64,m[8]=m[8]&63|128,p)for(var S=0;S<16;++S)p[_+S]=m[S];return p||d(m)}return Ce=u,Ce}var Re,it;function pr(){if(it)return Re;it=1;var s=yr(),d=gr(),u=d;return u.v1=s,u.v4=d,Re=u,Re}var xe,ot;function br(){if(ot)return xe;ot=1;var s=pr();return xe={generate:function(){var d=s.v1();return d.substr(14,4)+d.substr(9,4)+d.substr(0,8)+d.substr(19,4)+d.substr(24,d.length)},toBinary16:function(d){return new Buffer(d,"hex")},fromBinary16:function(d){return d.toString("hex")}},xe}var _r=br();const wr=st(_r);function K(s,d){return ee.call(this),z.log.call(this,s,d),{success:!0,message:s,data:d}}function Y(s){return ee.call(this),z.error.call(this,s),`Error: ${s}`}function Sr(s,d){if(s?typeof s=="object"&&!(s instanceof Array)||this.userErrors.push("Data passed to .add() must be an object. Not an array, string, number or boolean."):this.userErrors.push('No data specified in add() method. You must use an object, e.g { id: 1, name: "Bill", age: 47 }'),this.userErrors.length)se.call(this);else{let u=this.collectionName;return new Promise((y,p)=>{let h=null;return d?h=d:h=wr.generate(),this.lf[u].setItem(h,s).then(()=>{y(K.call(this,`Document added to "${u}" collection.`,{key:h,data:s}))}).catch(_=>{p(Y.call(this,`Could not add Document to ${u} collection.`))})})}}function at(s){for(var d=1;d<arguments.length;d++)for(var u in arguments[d]){var y=arguments[d][u];s[u]=y}return s}function Er(s){let d=this.collectionName,u=this.docSelectionCriteria;return new Promise((y,p)=>{this.updateDocumentByCriteria=()=>{let h=[];this.lf[d].iterate((_,m)=>{if(ne(_,u)){let S=at(_,s);h.push({key:m,newDocument:S})}}).then(()=>{h.length||p(Y.call(this,`No Documents found in ${d} Collection with criteria ${JSON.stringify(u)}.`)),h.length>1&&z.warn.call(this,`Multiple documents (${h.length}) with ${JSON.stringify(u)} found for updating.`)}).then(()=>{h.forEach((_,m)=>{this.lf[d].setItem(_.key,_.newDocument).then(S=>{m===h.length-1&&y(K.call(this,`${h.length} Document${h.length>1?"s":""} in "${d}" collection with ${JSON.stringify(u)} updated.`,s))}).catch(S=>{p(Y.call(this,`Could not update ${h.length} Documents in ${d} Collection.`))})})})},this.updateDocumentByKey=()=>{let h={};this.lf[d].getItem(u).then(_=>{h=at(_,s),this.lf[d].setItem(u,h),y(K.call(this,`Document in "${d}" collection with key ${JSON.stringify(u)} updated.`,h))}).catch(_=>{p(Y.call(this,`No Document found in "${d}" collection with key ${JSON.stringify(u)}`))})},s?typeof s=="object"&&!(s instanceof Array)||this.userErrors.push("Data passed to .update() must be an object. Not an array, string, number or boolean."):this.userErrors.push('No update object provided to update() method. Use an object e.g. { name: "William" }'),this.userErrors.length?se.call(this):typeof u=="object"?this.updateDocumentByCriteria():this.updateDocumentByKey()})}function Nr(s,d={keys:!1}){let u=this.collectionName,y=this.docSelectionCriteria,p=Be.call(this);return new Promise((h,_)=>{if(this.setCollection=()=>{this.lf[u].clear().then(()=>{if(!d.keys)s.forEach(m=>{this.add(m)}),h(K.call(this,`Collection "${u}" set with ${s.length} Documents.`,s));else{console.log("keys provided");let m=0;s.forEach(S=>{S.hasOwnProperty("_key")||m++}),m?_(Y.call(this,"Documents provided to .set() in an array must each have a _key property set to a string.")):(s.forEach(S=>{let I=S._key;delete S._key,this.add(S,I)}),h(K.call(this,`Collection "${u}" set with ${s.length} Documents.`,s)))}}).catch(m=>{_(Y.call(this,`Could not set ${u} Collection with data ${JSON.stringify(s)}.`))})},this.setDocument=()=>(this.setDocumentByCriteria=()=>{let m=[];this.lf[u].iterate((S,I)=>{ne(S,y)&&m.push({key:I,newDocument:s})}).then(()=>{m.length||_(Y.call(this,`No Documents found in ${u} Collection with criteria ${JSON.stringify(y)}.`)),m.length>1&&z.warn.call(this,`Multiple documents (${m.length}) with ${JSON.stringify(y)} found for setting.`)}).then(()=>{m.forEach((S,I)=>{this.lf[u].setItem(S.key,S.newDocument).then(O=>{I===m.length-1&&h(K.call(this,`${m.length} Document${m.length>1?"s":""} in "${u}" collection with ${JSON.stringify(y)} was set.`,s))}).catch(O=>{_(Y.call(this,`Could not set ${m.length} Documents in ${u} Collection.`))})})})},this.setDocumentByKey=()=>{this.lf[u].setItem(y,s).then(m=>{h(K.call(this,`Document in "${u}" collection with key ${JSON.stringify(y)} was set.`,s))}).catch(m=>{_(Y.call(this,`Document in "${u}" collection with key ${JSON.stringify(y)} could not be set.`))})},typeof y=="object"?this.setDocumentByCriteria():this.setDocumentByKey()),s?p==="doc"?typeof s=="object"&&!(s instanceof Array)||this.userErrors.push("Data passed to .set() must be an object. Not an array, string, number or boolean."):p==="collection"&&(typeof s=="object"&&s instanceof Array||this.userErrors.push("Data passed to .set() must be an array of objects. Not an object, string, number or boolean.")):this.userErrors.push('No new Document object provided to set() method. Use an object e.g. { id: 1, name: "Bill", age: 47 }'),this.userErrors.length)se.call(this);else{if(p=="collection")return this.setCollection();if(p=="doc")return this.setDocument()}})}function Dr(){return new Promise((s,d)=>{if(this.deleteDatabase=()=>{let u=this.dbName;indexedDB.deleteDatabase(u),s(K.call(this,`Database "${u}" deleted.`,{database:u}))},this.deleteCollection=()=>{let u=this.dbName,y=this.collectionName;this.addToDeleteCollectionQueue=p=>{this.deleteCollectionQueue.queue.push(p),this.runDeleteCollectionQueue()},this.runDeleteCollectionQueue=()=>{this.deleteCollectionQueue.running==!1&&(this.deleteCollectionQueue.running=!0,this.deleteNextCollectionFromQueue())},this.deleteNextCollectionFromQueue=()=>{if(this.deleteCollectionQueue.queue.length){let p=this.deleteCollectionQueue.queue[0];this.deleteCollectionQueue.queue.shift(),this.lf[p].dropInstance({name:u,storeName:p}).then(()=>{this.deleteNextCollectionFromQueue(),s(K.call(this,`Collection "${p}" deleted.`,{collection:p}))}).catch(h=>{d(h.call(this,`Collection "${p}" could not be deleted.`))})}else this.deleteCollectionQueue.running=!1},this.addToDeleteCollectionQueue(y)},this.deleteDocument=()=>{let u=this.collectionName,y=this.docSelectionCriteria;return this.deleteDocumentByCriteria=()=>{let p=[];this.lf[u].iterate((h,_)=>{ne(h,y)&&p.push(_)}).then(()=>{p.length||d(Y.call(this,`No Documents found in "${u}" Collection with criteria ${JSON.stringify(y)}. No documents deleted.`)),p.length>1&&z.warn.call(this,`Multiple documents (${p.length}) with ${JSON.stringify(y)} found.`)}).then(()=>{p.forEach((h,_)=>{this.lf[u].removeItem(h).then(()=>{_===p.length-1&&s(K.call(this,`${p.length} Document${p.length>1?"s":""} with ${JSON.stringify(y)} deleted.`,{keys:p}))}).catch(m=>{d(Y.call(this,`Could not delete ${p.length} Documents in ${u} Collection.`))})})})},this.deleteDocumentByKey=()=>{this.lf[u].getItem(y).then(p=>{p?this.lf[u].removeItem(y).then(()=>{s(K.call(this,`Document with key ${JSON.stringify(y)} deleted.`,{key:y}))}).catch(function(h){d(Y.call(this,`No Document found in "${u}" Collection with key ${JSON.stringify(y)}. No document was deleted.`))}):d(Y.call(this,`No Document found in "${u}" Collection with key ${JSON.stringify(y)}. No document was deleted.`))})},typeof y=="object"?this.deleteDocumentByCriteria():this.deleteDocumentByKey()},this.userErrors.length)se.call(this);else{let u=Be.call(this);if(u=="db")return this.deleteDatabase();if(u=="collection")return this.deleteCollection();if(u=="doc")return this.deleteDocument()}})}class Cr{constructor(d){this.dbName=d,this.lf={},this.collectionName=null,this.orderByProperty=null,this.orderByDirection=null,this.limitBy=null,this.docSelectionCriteria=null,this.deleteCollectionQueue={queue:[],running:!1},this.config={debug:!0},this.userErrors=[],this.collection=lr.bind(this),this.doc=hr.bind(this),this.orderBy=dr.bind(this),this.limit=vr.bind(this),this.get=mr.bind(this),this.add=Sr.bind(this),this.update=Er.bind(this),this.set=Nr.bind(this),this.delete=Dr.bind(this)}}export{Cr as L};
